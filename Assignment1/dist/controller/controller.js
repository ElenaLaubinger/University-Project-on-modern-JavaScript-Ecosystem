class BookController{constructor(a,b){this.model=a,this.view=b,this.manageTheme(),this.navigation(),this.setupRoutes(),this.showSuccessMessage=!1,this.view.setOnDeleteBook(this.handleDeleteBook.bind(this))}setupRoutes(){window.addEventListener("hashchange",()=>this.navigation()),this.navigation()}navigation(){const a=window.location.hash||"#add",b=this.getDetailIndexFromHash(a);"#add"===a?(this.view.displayAddBookForm(),this.view.bindAddBook(this.handleAddBook.bind(this))):"#list"===a?(this.view.displayBookList(this.model.getBooks()),this.showSuccessMessage&&(this.showMessage("success","Book added successfully"),this.showSuccessMessage=!1)):a.startsWith("#details")?this.handleBookDetails(b):"#zeroDetails"===a?this.view.displayZeroDetails():this.view.displayErrorPage(),this.manageView(),this.higlightLocationAtNavbar(a)}getDetailIndexFromHash(a){const b=a.match(/#details\-(\d+)/);return b?parseInt(b[1],10):null}manageView(){document.querySelector("#anchor").scrollIntoView(!1)}higlightLocationAtNavbar(a){null!==document.querySelector(".nav-link.active")&&document.querySelector(".nav-link.active").classList.remove("active"),"#error"!==a&&"#details"!==a?document.querySelector(a).classList.add("active"):"#details"===a&&document.querySelector("#zeroDetails").classList.add("active")}manageTheme(){const a="css/bootstrap.light.min.css",b=document.querySelector("#theme-toggle"),c=document.querySelector("#theme-stylesheet");c.getAttribute("href")==="css/bootstrap.light.min.css"?document.querySelector(".fa-moon").classList.remove("hidden"):document.querySelector(".fa-sun").classList.remove("hidden"),b.addEventListener("click",()=>{c.getAttribute("href")===a?(c.setAttribute("href","css/bootstrap.dark.min.css"),document.querySelector(".fa-moon").classList.add("hidden"),document.querySelector(".fa-sun").classList.remove("hidden")):(c.setAttribute("href",a),document.querySelector(".fa-sun").classList.add("hidden"),document.querySelector(".fa-moon").classList.remove("hidden"))})}handleAddBook(a,b,c,d){this.validateForm()&&(this.model.addBook(a,b,c,d),this.showSuccessMessage=!0,window.location.hash="#list")}handleDeleteBook(a){const b=document.querySelector(`#bookDetail-${a}`);b?anime({targets:b,translateX:500,opacity:0,duration:800,easing:"easeInOutSine",complete:()=>{this.model.deleteBook(a),this.view.displayBookList(this.model.getBooks())}}):(this.model.deleteBook(a),this.view.displayBookList(this.model.getBooks()))}handleBookDetails(a){const b=this.model.getBooks()[a];this.view.displayBookDetails(b)}showMessage(a,b){let c;"error"===a?c=document.querySelector("#error-message"):"success"==a&&(c=document.querySelector("#success-message")),c&&(this.manageView(),c.innerText=b,c.style.display="block",c.classList.add("show"),anime({targets:c,opacity:[0,1],duration:1e3,easing:"easeInOutSine",complete:()=>{setTimeout(()=>{anime({targets:c,opacity:[1,0],duration:1e3,easing:"easeInOutSine",complete:()=>{c.style.display="none"}})},3e3)}}))}validateForm(){const a=document.querySelector("#author").value.trim(),b=document.querySelector("#title").value.trim(),c=document.querySelector("#isbn").value.trim(),d=document.querySelector("#description").value.trim();if(""===a||""===b||""===c||""===d)return this.showMessage("error","Please fill in all fields"),!1;if(!/^(?=.*\d)(?=.{13}$)(\d{1,7}-\d{1,7}-\d{1,7}-[0-9X])$/.test(c))return this.showMessage("error","Invalid ISBN format. Example: 0-9752298-0-X"),!1;const e=this.model.getBooks(),f=e.some(a=>a.isbn===c);return!f||(this.showMessage("error","This ISBN already exists in the book list."),!1)}}